<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Wave Shooter</title>
<style>
  html,body {margin:0;padding:0;height:100%;background:#111;overflow:hidden;color:#eee;font-family:Arial;}
  #hud {position:absolute;top:8px;left:50%;transform:translateX(-50%);display:flex;gap:20px;font-size:15px;background:rgba(0,0,0,0.4);padding:6px 12px;border-radius:8px;}
  canvas {display:block;width:100vw;height:100vh;background:#000;}
</style>
</head>
<body>
<canvas id="game"></canvas>
<div id="hud">
  <span>Wave: <b id="wave">1</b></span>
  <span>Enemies: <b id="enemies">0</b></span>
  <span>HP: <b id="hp">100</b></span>
  <span>Score: <b id="score">0</b></span>
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
let W = innerWidth, H = innerHeight;
canvas.width = W;
canvas.height = H;

const elWave = document.getElementById("wave");
const elEnemies = document.getElementById("enemies");
const elHp = document.getElementById("hp");
const elScore = document.getElementById("score");

let keys = {}, mouse = {x:W/2,y:H/2,down:false};
let bullets = [], enemies = [], particles = [];
let wave = 1, betweenWave = 0, score = 0;
let lastShot = 0, gameOver = false;
const player = {x:W/2,y:H/2,r:16,speed:240,hp:100};
const shotDelay = 150;

let cheatUnlocked = false;
let gamePaused = false;
let aimbotTarget = null;

function rand(min,max){return Math.random()*(max-min)+min;}
function dist(a,b){return Math.hypot(a.x-b.x,a.y-b.y);}

function spawnEnemy(){
  const side = Math.floor(Math.random()*4);
  let x,y;
  if(side===0){x=-20;y=rand(0,H);}
  else if(side===1){x=W+20;y=rand(0,H);}
  else if(side===2){x=rand(0,W);y=-20;}
  else {x=rand(0,W);y=H+20;}

  const t = Math.random();
  let color, speed, hp;
  if(t<0.6){color="#f33";speed=70+wave*3;hp=1;}
  else if(t<0.85){color="#f75";speed=140+wave*4;hp=1;}
  else {color="#a22";speed=45+wave*2;hp=3;}
  enemies.push({x,y,r:rand(10,18),speed,hp,color});
}

function startWave(){
  const count = 2*wave;
  for(let i=0;i<count;i++) spawnEnemy();
}
startWave();

function shootAt(targetX,targetY){
  const now = performance.now();
  if(!cheatUnlocked && now-lastShot<shotDelay) return;
  lastShot = now;

  const ang = Math.atan2(targetY-player.y, targetX-player.x);
  const spd=700;
  bullets.push({
    x:player.x+Math.cos(ang)*16,
    y:player.y+Math.sin(ang)*16,
    vx:Math.cos(ang)*spd,
    vy:Math.sin(ang)*spd,
    life:1400
  });
}

function selectAimbotTarget(){
  if(!cheatUnlocked) return;
  if(enemies.length===0){ aimbotTarget=null; return;}
  if(!aimbotTarget || !enemies.includes(aimbotTarget)){
    aimbotTarget = enemies.reduce((prev,curr)=>dist(curr,player)<dist(prev,player)?curr:prev);
  }
}

function autoAimAndShoot(){
  if(!cheatUnlocked || gameOver) return;
  selectAimbotTarget();
  if(aimbotTarget) shootAt(aimbotTarget.x, aimbotTarget.y);
}

function createExplosion(x,y,color){
  for(let i=0;i<15;i++){
    particles.push({x,y,vx:rand(-200,200),vy:rand(-200,200),life:rand(400,800),size:rand(2,4),color});
  }
}

function reset(){
  bullets=[];enemies=[];particles=[];
  player.hp=100;wave=1;score=0;gameOver=false;
  betweenWave=0;startWave();
  aimbotTarget=null;
}

window.addEventListener("keydown",e=>{
  keys[e.key.toLowerCase()]=true;
  if(e.key==="r")reset();
  if(e.key.toLowerCase()==="t" && !gamePaused){
    gamePaused = true;
    const val = prompt("Enter code:");
    if(val==="1ty8"){
      cheatUnlocked = true;
      alert("Cheat activated: insane fire rate + auto-aim & shoot!");
    }
    gamePaused = false;
  }
});
window.addEventListener("keyup",e=>{keys[e.key.toLowerCase()]=false;});
canvas.addEventListener("mousemove",e=>{
  const rect=canvas.getBoundingClientRect();
  mouse.x=(e.clientX-rect.left)*(canvas.width/rect.width);
  mouse.y=(e.clientY-rect.top)*(canvas.height/rect.height);
});
canvas.addEventListener("mousedown",()=>{mouse.down=true;});
canvas.addEventListener("mouseup",()=>mouse.down=false);

function update(dt){
  if(gameOver || gamePaused) return;

  let dx=0,dy=0;
  if(keys["w"]||keys["arrowup"])dy-=1;
  if(keys["s"]||keys["arrowdown"])dy+=1;
  if(keys["a"]||keys["arrowleft"])dx-=1;
  if(keys["d"]||keys["arrowright"])dx+=1;
  if(dx||dy){
    const l=Math.hypot(dx,dy);dx/=l;dy/=l;
    player.x+=dx*player.speed*dt;
    player.y+=dy*player.speed*dt;
    player.x=Math.max(player.r,Math.min(W-player.r,player.x));
    player.y=Math.max(player.r,Math.min(H-player.r,player.y));
  }

  // player shooting
  if(mouse.down) shootAt(mouse.x, mouse.y);
  // auto aim + shoot
  autoAimAndShoot();

  // bullets update
  for(let i=bullets.length-1;i>=0;i--){
    const b=bullets[i];
    b.x+=b.vx*dt;b.y+=b.vy*dt;b.life-=dt*1000;
    if(b.life<=0||b.x<-20||b.x>W+20||b.y<-20||b.y>H+20)bullets.splice(i,1);
  }

  // particles update
  for(let i=particles.length-1;i>=0;i--){
    const p=particles[i];
    p.x+=p.vx*dt;p.y+=p.vy*dt;
    p.vx*=0.96;p.vy*=0.96;
    p.life-=dt*1000;
    if(p.life<=0)particles.splice(i,1);
  }

  // enemies move
  for(let i=enemies.length-1;i>=0;i--){
    const e=enemies[i];
    const ang=Math.atan2(player.y-e.y,player.x-e.x);
    e.x+=Math.cos(ang)*e.speed*dt;
    e.y+=Math.sin(ang)*e.speed*dt;
    if(dist(e,player)<e.r+player.r){
      player.hp-=8;
      createExplosion(e.x,e.y,e.color);
      enemies.splice(i,1);
      if(aimbotTarget===e) aimbotTarget=null;
      continue;
    }
  }

  // enemy vs enemy collision
  for(let i=0;i<enemies.length;i++){
    for(let j=i+1;j<enemies.length;j++){
      const e1=enemies[i], e2=enemies[j];
      const d=dist(e1,e2);
      const minDist=e1.r+e2.r;
      if(d<minDist && d>0){
        const overlap=(minDist-d)/2;
        const nx=(e1.x-e2.x)/d;
        const ny=(e1.y-e2.y)/d;
        e1.x+=nx*overlap;e1.y+=ny*overlap;
        e2.x-=nx*overlap;e2.y-=ny*overlap;
      }
    }
  }

  // bullet hits enemy
  for(let i=enemies.length-1;i>=0;i--){
    const e=enemies[i];
    for(let j=bullets.length-1;j>=0;j--){
      const b=bullets[j];
      if(dist(e,b)<e.r+4){
        bullets.splice(j,1);
        e.hp--;
        if(e.hp<=0){
          score+=10;
          createExplosion(e.x,e.y,e.color);
          if(aimbotTarget===e) aimbotTarget=null;
          enemies.splice(i,1);
        }
        break;
      }
    }
  }

  // wave handling
  if(enemies.length===0 && betweenWave<=0){
    betweenWave=3;
  }
  if(betweenWave>0){
    betweenWave-=dt;
    if(betweenWave<=0){
      wave++;
      startWave();
    }
  }

  if(player.hp<=0){player.hp=0;gameOver=true;}

  elWave.textContent=wave;
  elEnemies.textContent=enemies.length;
  elHp.textContent=Math.floor(player.hp);
  elScore.textContent=score;
}

function draw(){
  ctx.fillStyle="#000";ctx.fillRect(0,0,W,H);

  // bullets
  ctx.fillStyle="#ffd";
  for(const b of bullets){ctx.beginPath();ctx.arc(b.x,b.y,4,0,Math.PI*2);ctx.fill();}

  // enemies
  for(const e of enemies){ctx.beginPath();ctx.arc(e.x,e.y,e.r,0,Math.PI*2);ctx.fillStyle=e.color;ctx.fill();}

  // particles
  for(const p of particles){
    ctx.globalAlpha = Math.max(0,p.life/800);
    ctx.fillStyle = p.color;
    ctx.beginPath();
    ctx.arc(p.x,p.y,p.size,0,Math.PI*2);
    ctx.fill();
    ctx.globalAlpha = 1;
  }

  // player
  const grad = ctx.createLinearGradient(player.x-player.r,player.y-player.r,player.x+player.r,player.y+player.r);
  grad.addColorStop(0,"#7dc8ff");grad.addColorStop(1,"#2767ff");
  ctx.beginPath();ctx.arc(player.x,player.y,player.r,0,Math.PI*2);ctx.fillStyle=grad;ctx.fill();
  ctx.lineWidth=1.5;ctx.strokeStyle="#0d204f";ctx.stroke();

  // barrel direction (aim)
  let aimX = mouse.x, aimY = mouse.y;
  if(cheatUnlocked && aimbotTarget){
    aimX = aimbotTarget.x;
    aimY = aimbotTarget.y;
  }
  const a=Math.atan2(aimY-player.y,aimX-player.x);
  ctx.beginPath();ctx.moveTo(player.x,player.y);
  ctx.lineTo(player.x+Math.cos(a)*(player.r+10),player.y+Math.sin(a)*(player.r+10));
  ctx.strokeStyle="#cce3ff";ctx.lineWidth=2;ctx.stroke();

  if(enemies.length===0 && !gameOver && betweenWave>0){
    ctx.fillStyle="rgba(255,255,255,0.1)";
    ctx.fillRect(W/2-150,H/2-50,300,100);
    ctx.fillStyle="#fff";ctx.textAlign="center";ctx.font="24px Arial";
    ctx.fillText("Wave "+(wave+1)+" in "+Math.ceil(betweenWave),W/2,H/2+8);
  }

  if(gameOver){
    ctx.fillStyle="rgba(0,0,0,0.6)";
    ctx.fillRect(0,0,W,H);
    ctx.fillStyle="#ff6b6b";ctx.font="40px Arial";ctx.textAlign="center";
    ctx.fillText("YOU DIED",W/2,H/2-10);
    ctx.fillStyle="#fff";ctx.font="18px Arial";
    ctx.fillText("Score: "+score+" â€” Press R to restart",W/2,H/2+28);
  }
}

let last=performance.now();
function loop(now){
  const dt=Math.min(0.05,(now-last)/1000);
  last=now;
  update(dt);
  draw();
  requestAnimationFrame(loop);
}
loop(last);

function resize(){W=innerWidth;H=innerHeight;canvas.width=W;canvas.height=H;player.x=Math.min(player.x,W-player.r);player.y=Math.min(player.y,H-player.r);}
window.addEventListener("resize",resize);
</script>
</body>
</html>
