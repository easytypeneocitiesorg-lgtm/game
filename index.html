<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Wave Shooter</title>
<style>
  html,body{margin:0;padding:0;height:100%;background:#111;color:#eee;font-family:Arial, sans-serif;overflow:hidden}
  #wrap{display:flex;flex-direction:column;align-items:center;padding:10px}
  canvas{background:#000;border:2px solid #222;border-radius:6px;margin-top:10px;touch-action:none}
  .hud{display:flex;gap:20px;margin-top:5px;font-size:15px}
</style>
</head>
<body>
<div id="wrap">
  <h2>Wave Shooter</h2>
  <div class="hud">
    <span>Wave: <b id="wave">1</b></span>
    <span>Enemies: <b id="enemies">0</b></span>
    <span>HP: <b id="hp">100</b></span>
    <span>Score: <b id="score">0</b></span>
  </div>
  <canvas id="game" width="900" height="600"></canvas>
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const W = canvas.width, H = canvas.height;

const elWave = document.getElementById("wave");
const elEnemies = document.getElementById("enemies");
const elHp = document.getElementById("hp");
const elScore = document.getElementById("score");

let keys = {}, mouse = {x:W/2,y:H/2,down:false};
let bullets = [], enemies = [], particles = [];
let wave = 1, betweenWave = 0, score = 0;
let lastShot = 0, gameOver = false;
const player = {x:W/2,y:H/2,r:14,speed:240,hp:100};
const shotDelay = 150;

// helpers
function rand(min,max){return Math.random()*(max-min)+min;}
function dist(a,b){return Math.hypot(a.x-b.x,a.y-b.y);}

// spawn enemies
function spawnEnemy(){
  const side = Math.floor(Math.random()*4);
  let x,y;
  if(side===0){x=-20;y=rand(0,H);}
  else if(side===1){x=W+20;y=rand(0,H);}
  else if(side===2){x=rand(0,W);y=-20;}
  else {x=rand(0,W);y=H+20;}

  // types: normal, fast, tank
  const t = Math.random();
  let type, color, speed, hp;
  if(t<0.6){type="normal";color="rgba(255,60,60,0.95)";speed=70+wave*3;hp=1;}
  else if(t<0.85){type="fast";color="rgba(255,120,60,0.95)";speed=140+wave*4;hp=1;}
  else {type="tank";color="rgba(180,30,30,0.95)";speed=45+wave*2;hp=3;}
  enemies.push({x,y,r:rand(10,18),speed, hp,color,type});
}

function startWave(){
  const count = 2*wave;
  for(let i=0;i<count;i++) spawnEnemy();
}

startWave();

function shoot(){
  const now = performance.now();
  if(now-lastShot<shotDelay || gameOver) return;
  lastShot=now;
  const ang=Math.atan2(mouse.y-player.y,mouse.x-player.x);
  const spd=700;
  bullets.push({x:player.x+Math.cos(ang)*16,y:player.y+Math.sin(ang)*16,vx:Math.cos(ang)*spd,vy:Math.sin(ang)*spd,life:1400});
}

function reset(){
  bullets=[];enemies=[];particles=[];
  player.hp=100;wave=1;score=0;gameOver=false;
  betweenWave=0;startWave();
}

window.addEventListener("keydown",e=>{
  keys[e.key.toLowerCase()]=true;
  if(e.key==="r")reset();
});
window.addEventListener("keyup",e=>{keys[e.key.toLowerCase()]=false;});
canvas.addEventListener("mousemove",e=>{
  const r=canvas.getBoundingClientRect();
  mouse.x=(e.clientX-r.left)*(canvas.width/r.width);
  mouse.y=(e.clientY-r.top)*(canvas.height/r.height);
});
canvas.addEventListener("mousedown",()=>{mouse.down=true;shoot();});
canvas.addEventListener("mouseup",()=>mouse.down=false);

function update(dt){
  if(gameOver) return;

  let dx=0,dy=0;
  if(keys["w"]||keys["arrowup"])dy-=1;
  if(keys["s"]||keys["arrowdown"])dy+=1;
  if(keys["a"]||keys["arrowleft"])dx-=1;
  if(keys["d"]||keys["arrowright"])dx+=1;
  if(dx||dy){
    const l=Math.hypot(dx,dy);dx/=l;dy/=l;
    player.x+=dx*player.speed*dt;
    player.y+=dy*player.speed*dt;
    player.x=Math.max(player.r,Math.min(W-player.r,player.x));
    player.y=Math.max(player.r,Math.min(H-player.r,player.y));
  }

  if(mouse.down)shoot();

  // bullets
  for(let i=bullets.length-1;i>=0;i--){
    const b=bullets[i];
    b.x+=b.vx*dt;b.y+=b.vy*dt;b.life-=dt*1000;
    if(b.life<=0||b.x<-20||b.x>W+20||b.y<-20||b.y>H+20)bullets.splice(i,1);
  }

  // enemies
  for(let i=enemies.length-1;i>=0;i--){
    const e=enemies[i];
    const ang=Math.atan2(player.y-e.y,player.x-e.x);
    e.x+=Math.cos(ang)*e.speed*dt;
    e.y+=Math.sin(ang)*e.speed*dt;
    if(dist(e,player)<e.r+player.r){
      player.hp-=e.type==="tank"?12:8;
      enemies.splice(i,1);
      continue;
    }
  }

  // collisions
  for(let i=enemies.length-1;i>=0;i--){
    const e=enemies[i];
    for(let j=bullets.length-1;j>=0;j--){
      const b=bullets[j];
      if(dist(e,b)<e.r+4){
        bullets.splice(j,1);
        e.hp--;
        if(e.hp<=0){
          score+=e.type==="tank"?30:(e.type==="fast"?15:10);
          enemies.splice(i,1);
        }
        break;
      }
    }
  }

  // wave logic
  if(enemies.length===0 && betweenWave<=0){
    betweenWave=3;
  }
  if(betweenWave>0){
    betweenWave-=dt;
    if(betweenWave<=0){
      wave++;
      startWave();
    }
  }

  if(player.hp<=0){player.hp=0;gameOver=true;}

  elWave.textContent=wave;
  elEnemies.textContent=enemies.length;
  elHp.textContent=Math.floor(player.hp);
  elScore.textContent=score;
}

function draw(){
  ctx.fillStyle="#000";
  ctx.fillRect(0,0,W,H);

  // bullets
  ctx.fillStyle="#ff9";
  for(const b of bullets){
    ctx.beginPath();
    ctx.arc(b.x,b.y,4,0,Math.PI*2);
    ctx.fill();
  }

  // enemies
  for(const e of enemies){
    ctx.beginPath();
    ctx.arc(e.x,e.y,e.r,0,Math.PI*2);
    ctx.fillStyle=e.color;
    ctx.fill();
  }

  // player
  ctx.beginPath();
  ctx.arc(player.x,player.y,player.r,0,Math.PI*2);
  ctx.fillStyle="#5aa6ff";
  ctx.fill();

  // pointer
  const a=Math.atan2(mouse.y-player.y,mouse.x-player.x);
  ctx.beginPath();
  ctx.moveTo(player.x,player.y);
  ctx.lineTo(player.x+Math.cos(a)*(player.r+12),player.y+Math.sin(a)*(player.r+12));
  ctx.strokeStyle="#cfefff";
  ctx.lineWidth=2;
  ctx.stroke();

  // between waves
  if(enemies.length===0 && !gameOver && betweenWave>0){
    ctx.fillStyle="rgba(255,255,255,0.1)";
    ctx.fillRect(W/2-150,H/2-50,300,100);
    ctx.fillStyle="#fff";
    ctx.textAlign="center";
    ctx.font="24px Arial";
    ctx.fillText("Wave "+(wave+1)+" in "+Math.ceil(betweenWave),W/2,H/2+8);
  }

  // death
  if(gameOver){
    ctx.fillStyle="rgba(0,0,0,0.6)";
    ctx.fillRect(0,0,W,H);
    ctx.fillStyle="#ff6b6b";
    ctx.font="40px Arial";
    ctx.textAlign="center";
    ctx.fillText("YOU DIED",W/2,H/2-10);
    ctx.fillStyle="#fff";
    ctx.font="18px Arial";
    ctx.fillText("Score: "+score+" â€” Press R to restart",W/2,H/2+28);
  }
}

let last=performance.now();
function loop(now){
  const dt=Math.min(0.05,(now-last)/1000);
  last=now;
  update(dt);
  draw();
  requestAnimationFrame(loop);
}
loop(last);
</script>
</body>
</html>
